---
title: js垃圾回收
date: 2022-04-06 16:06:58
categories: [JavaScript]
tags: 
- 垃圾回收
- JavaScript
---

# js垃圾回收机制

1. 找出不在使用的变量
2. 释放器内存空间
3. 固定的时间间隔执行

# 标记清除

当变量进入执行环境是，就标记这个变量为“进入环境“，进入环境的变量所占用的内存就不能释放。当变量离开环境时，则将其标记为“离开环境“。

被标记为“离开环境”的变量等待垃圾回收。

全局变量和闭包所形成的特殊的变量不会被标记为“离开环境”：

```js
function f1(){
    let a=1
    return function f2(){
        a++
        console.log(a)
    }
}

const f3 = f1()
f3() //2
f3() //3
```

在上述代码中，函数执行完之后变量a并没有消失，因为不会被标记清除，也就是不会被垃圾回收。

解决：

```js
f3 = null
```

# 引用计数

根据一个值的引用次数来判断是否进行垃圾回收，如果一个值的引用次数是`0`，就表示这个值不再用到了，因此可以将这块内存释放。

```js
const a = new Object() //a的引用数:1
const b = new Object() //b的引用数:1

let c = a //a的引用数:2
let c = b //a的引用数:1,b的引用数:2

a.prop = b
b.prop = a //a的引用数:2,b的引用数:2
```

如上所示，a和b的引用数永远都大于0，不会被垃圾回收。所以使用引用计数来进行垃圾回收的浏览器较少。

解决：(解除引用)

```js
a = null
b = null
```







[参考视频](https://www.bilibili.com/video/BV1o44y1z7bQ?t=255.2)
